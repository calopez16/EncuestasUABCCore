@{
    Layout = null;
}

<link rel="stylesheet" type="text/css" href="~/lib/summernote/dist/summernote.css" />
<div class="modal fade" id="modal_CrearEncuesta" tabindex="-1" role="dialog" aria-labelledby="modal_CrearEncuesta" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <form asp-action="Crear" class="modal-content" id="form_CrearEncuesta">
            <div class="modal-header">
                <h5 class="modal-title">Crear Encuesta</h5>
                <span type="button" class="btn" data-dismiss="modal">
                    <i class="fa fa-times"></i>
                </span>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="col-md-10">
                        <label class="control-label">Nombre</label>
                        <input name="Nombre" class="form-control" id="txt_Nombre" />
                    </div>
                </div>
                <div class="form-row mt-2">
                    <div class="col-md-4 form-group">
                        <label class="form-control-label">Campus</label><br />
                        <select class="form-control select2" asp-items="ViewBag.Campus" id="select_Campus">
                            <option value="">Seleccionar</option>
                        </select>
                    </div>
                    <div class="col-md-4 form-group">
                        <label class="form-control-label">Unidad Académica</label><br />
                        <select class="form-control select2" id="select_UnidadAcademica">
                            <option value="">Seleccionar</option>
                        </select>
                    </div>
                    <div class="col-md-4 form-group">
                        <label class="control-label">Carrera</label><br />
                        <select name="CarreraId" class="form-control select2" id="select_Carrera">
                            <option value="">Seleccionar</option>
                        </select>
                    </div>
                </div>
                <div class="form-group mt-2">
                    <label class="control-label">Descripción</label>
                    <textarea name="Descripcion" class="form-control" id="txtArea_Descripcion"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="submit" class="btn btn-primary" id="btn_GuardarNombreDescripcion">Guardar</button>
            </div>
        </form>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        $('#txtArea_Descripcion').summernote({
            toolbar: [
                ['undo', ['undo', 'redo']],
                ['style', ['bold', 'italic', 'underline', 'clear']],
                ['fontsize', ['fontsize']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['height', ['height']],
                ['table', ['table']],
                ['fullscreen', ['fullscreen']]
            ],
            height: 300,
            lang: "es-ES"
        });
        $("#select_Campus").change(function () {
            var campusId = $(this).val();
            $("#select_UnidadAcademica").empty();
            $("#select_Carrera").empty();
            CargarUnidadesAcademicas(campusId);
            CargarCarreras(0);
        });

        $("#select_UnidadAcademica").change(function () {
            var unidadAcademicaId = $(this).val();
            $("#select_Carrera").empty();
            CargarCarreras(unidadAcademicaId);
        });

        $("#btn_CambiarContrasena").click(function () {
            var email = $(this).data("email");
            $("#txt_EmailContrasena").val(email);
            $("#modal_CambiarContrasena").modal("show");
        });

        $("#form_CrearEncuesta").validate({
            rules: {
                Nombre: "required",
                CarreraId: "required",
            },
            messages: {
                Nombre: "El campo Nombre es obligatorio",
                CarreraId: "El campo Carrera es obligatorio",
            },
            errorPlacement: function (error, element) {
                if (element.hasClass('select2') && element.next('.select2-container').length) {
                    error.insertAfter(element.next('.select2-container'));
                } 
                else {
                    error.insertAfter(element);
                }
            }
        });

    });

    function CargarUnidadesAcademicas(campusId, unidadAcademicaId) {
        $.ajax({
            //Url de la peticion
            url: "../Usuarios/UnidadesAcademicas",
            //Tipo de petición
            type: "POST",
            //Datos que se enviaran a la llamada
            data: { campusId: campusId },
            //Accion al comenzar la carga de la peticion AJAX.
            beforeSend: function () {
                //Aqui regularmente se implementa un loading.
            }
        }).done(function (data) {
            //Se ejecuta cuando la peticion ha sido exitosa.
            //data es la respuesta que se recibe.
            data.unshift({ id: "", text: "Seleccionar" });
            $("#select_UnidadAcademica").select2({
                data: data,
            });
            if (unidadAcademicaId != undefined) {
                $("#select_UnidadAcademica").val(unidadAcademicaId);
                $("#select_UnidadAcademica").trigger('change');
            }
            $('select:not(.normal)').each(function () {
                $(this).select2({
                    dropdownParent: $(this).parent()
                });
            });
        }).fail(function () {
            //Se ejecuta cuando la peticion ha regresado algun error.
        }).always(function () {
            //Se ejecuta al final de la peticion sea exitosa o no.
        });
    }

    function CargarCarreras(unidadAcademicaId, carreraId) {
        $.ajax({
            //Url de la peticion
            url: "../Usuarios/Carreras",
            //Tipo de petición
            type: "POST",
            //Datos que se enviaran a la llamada
            data: { unidadAcademicaId: unidadAcademicaId },
            //Accion al comenzar la carga de la peticion AJAX.
            beforeSend: function () {
                //Aqui regularmente se implementa un loading.
            }
        }).done(function (data) {
            //Se ejecuta cuando la peticion ha sido exitosa.
            //data es la respuesta que se recibe.
            data.unshift({ id: "", text: "Seleccionar" });
            $("#select_Carrera").select2({ data: data });
            if (carreraId != undefined) {
                $("#select_Carrera").val(carreraId);
                $("#select_Carrera").trigger('change');
            }
            $('select:not(.normal)').each(function () {
                $(this).select2({
                    dropdownParent: $(this).parent()
                });
            });
        }).fail(function () {
            //Se ejecuta cuando la peticion ha regresado algun error.
        }).always(function () {
            //Se ejecuta al final de la peticion sea exitosa o no.
        });
    }
</script>

<script type="text/javascript" src="~/lib/summernote/dist/summernote.js"></script>
